## Лабораторная работа №5
# Реализация и исследование алгоритмов растрового заполнения сплошных областей
### Алгоритм заполнения со списком рёбер и флагом
**Цель работы**: реализация и исследование одного из алгоритмов (по заданию преподавателя)  растрового заполнения области.

В рамках данной работы необходимо:
* реализовать один из алгоритмов заполнения сплошной области;
* обеспечить ввод произвольной многоугольной области, содержащей произвольное количество отверстий:
    * ввод (вершин многоугольника) производить с помощью мыши, при этом для удобства пользователя должны отображаться ребра, соединяющие вводимые вершины;
    * предусмотреть ввод горизонтальных и вертикальных ребер;
* дать пользователю возможность задания цвета заполнения;
* предусмотреть два режима работы программы — с задержкой и без задержки;
    * режим с задержкой должен позволить проследить выполняемую последовательность действий. (Задержку целесообразно выполнять после обработки очередной строки);
* обеспечить замер времени выполнения алгоритма (без задержки, с выводом на экран только окончательного результата).

**Варианты:** (N % 4)

1 — Алгоритм заполнения с упорядоченным списком рёбер и флагом

2 — Алгоритм заполнения по рёбрам

3 — Алгоритм заполнения с перегородкой

0 — Алгоритм заполнения со списком рёбер и флагом

## Материалы с лекции, необходимые для сдачи лабораторной

***Растровая развертка сплошных областей*** — генерация сплошных областей на основе простых описаний вершин/ребер.

***Цель***: построить многоугольную область, закрашенную внутри. Пиксели, принадлежащие многоугольнику высвечиваются заданным цветом.

С точки зрения геометрии, нужно для всех точек найти те, которые принадлежат многоугольнику.


**Тест с лучом**: Испускаем леч из анализируемой точки (лучше вертикальный или горизонтальный).

Посчитать количество пересечений луча с ребрами многоугольника N.

Если
- N — четное, то точка расположена **вне** многоугольника.
- N — нечетное, то точка расположена **внутри** многоугольника.

***Проблема***: Когда луч проходит через вершину.

***Решение***: Попытаться взять другой луч через эту точку.

### Алгоритмы заполнения
**1. Алгоритмы растрового заполнения**

- Задача решается для пикселей, принадлежащих каждой сканирующей строке, пересекающей многоугольник.

**2. Алгоритмы затравочного заполнения**

- Должен быть задан исходный затравочный пиксель. На основе одного затравочного пикселя ищутся новые затравочные пиксели, которые и закрашиваются.

Сократить трудоёмкоcть решения задачи принадлежности можно, используя прямоуг. объемл. оболочку. Но есть случаи, при которых такой подход неоптимален.

### Растровые алгоритмы заполнения
Задача решается для пикселей каждой сканирующей строки, пересекающей многоугольник. Принадлежность пикселей многоугольнику изменяется только в точках пересечения сканирующей строки с ребрами многоугольника.

1) Найти точки пересечения сканирующей строки с рёбрами многоугольника.
2) Упорядочить точки пересечения сканирующей строки с рёбрами многоугольника по убыванию абсциссы.
3) Упорядоченный список рёбер разбить на пары.
4) Закрасить пиксели, расположенные внутри интервала, образованного каждой парой пикселей.

**Проблемы:**

1) Горизонтальные рёбра (Решение — отбросить)
3) Сканирующие строки, проходящие через вершины многоугольника тол-ко перечесения в одних вершиках надо считать равным двум, а в других — равным одному.



### Алгоритм с упорядоченным списком рёбер
#### Простой вариант алгоритма:
1) Нахождение точек пересечения сканирующих строк, пересекающих многоугольник, с рёбрами.
    
    `(x1, y1) (x2, y2) ... (xn, yn)`
2) Сортировка точек пересечения по невозрастанию координаты `y`.

    `... (xi, yi) (xj, yj) ,,,          yi >= yj`
3) Сортировка точек пересечения с одинаковым значением координаты `у` по неубыванию координаты `х`.

    `(x1, ye) (x2, ye) ... (xm, ye)     x1 <= x2 <= ... <= xm <= ...`
4) Точки пересечения (отсортированные) с одинаковой ординатой разбиваем на пары.
5) Закраска пикселей в интервалах, ограниченных каждой образованной парой.

#### Более эффективный вариант алгоритма:

    Выделяем память, разбиваем её на группы
    —————————————————
    | x1, x3 ... xe | y1
    —————————————————
    | x2, x5 ... xk | y2
    —————————————————
    | x4   ...   xm | y3
    —————————————————
    |               |
    —————————————————
    | x6   ...   xp |
    —————————————————
    | x7   ...   xz |
    —————————————————
    |               | yn
    —————————————————
1) Нахождение точек пересечения с одновременным значением 4х абсцисс в соответствующие y-группы.
2) Сортировка точек пересечения, расположенных на каждой сканирующей строке, по неубыванию.
3) Образование пар точек.
4) Закраска пикселей, расположенных внутри каждого интервала.

#### Эффективный вариант алгоритма, использующий список рёбер:
Каждое ребро характеризуется:

* номером наивысшей сканирующей строки, пересекающей ребро;
* абсциссой наивысшей вершины ребра;
* количеством строк, пересекающих рёбра;
* изменением абсциссы точки пересечения ребра со сканирующей строкой `Δx`.

1. Количество обрабатываемых пикселей.
2. Количество раз, которое приходится считывать цвет пикселя.
3. Количество изменений цвета каждого пикселя.

### Алгоритм заполнения по рёбрам
* цвет заполнения
* цвет фона

Цвет закраски = !цвет фона (инферсия); И наоборот.

Дополнить все пиксели сканирующей строки, расположенные правее точки пересечения ребра многоугольника со сканирующей строкой.
Это необходимо сделать для всех сканирующих строк, пересекающих рёбра многоугольника.

Рёбра можно обрабатывать в произвольном порядке, сортировка не требуется.

Пример работы алгоритма:


### Алгоритм заполнения с перегородкой
**Перегородка** — воображаемая вертикальная линия.

Дополнить все пиксели сканирующей строки, расположенные правее точки пересечения ребра со сканирующей строкой, но левее перегородки, если перегородка расположена правее точки пересечения.

Дополнить все пиксели сканирующей строки, расположенные левее точки пересечения ребра со сканирующей строкой, но правее перегородки, если перегородка расположена левее точки пересечения.

### Алгоритм со списком рёбер и флагом
**Флаг** — признак принадлежности пикселя рассматриваемой (закрашиваемой) области.

Алгоритм является двухшаговым:
* Очерчивание границ многоугольника.
* Заполнение области.

`flag = false`

Значение флага инвертируется в том случае, когда цвет пикселя совпадает с цветом границы.

Цвет границы должен отличаться от цвета закраски.
Граница должна быть толщиной в 1 пиксель.

Должно быть задано:
* Информация о границе
* Цвет границы
* Цвет закраски

